---
title: 'Assignment 1.1: Module 1 Exercises'
author: "Zachariah Freitas"
date: "`r Sys.Date()`"
output: pdf_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Chapter 1:

Approaching Forecasting (Page 23) #1-5 

### Question 1.
Is the goal of this study descriptive or predictive?

#### Question CH1-Q1 Answer:

**Answer:** The goal of this study is to be descriptive. To understand long distance  passenger travel behavior patterns before and after September 11th 2001.

### Question 2.

What is the forecast horizon to consider in this task?
Are next-month forecasts sufficient?

#### Question CH1-Q2 Answer:

```{r 911}

Sept11Travel <- read_excel("Sept11Travel.xls", 
    col_types = c("date", "numeric", "numeric", 
        "numeric"))


ggplot(Sept11Travel, aes(x = Month, y = `Air RPM (000s)`, group = 1)) +
  geom_line(size = 1, color = "green") +
  theme_classic()

# 
# ggplot(Sept11Travel, aes(x = Month, y = `Rail PM`, group = 1)) +
#   geom_line(size = 1, color = "green") +
#   theme_classic()
# 
# 
# ggplot(Sept11Travel, aes(x = Month, y = `VMT (billions)`, group = 1)) +
#   geom_line(size = 1, color = "green") +
#   theme_classic()

  


```

**Answer:** Impacts to 9/11 was felt for years after the attack. So looking at several months to several years might be appropriate. 

### Question 3.

What level of automation does this forecasting task require? Consider the four questions related to automation.

#### Question CH1-Q3 Answer:

**Answer:**

### Question 4.

What does the meaning of t = 1,2,3 in the Air series?
Which time period does t = 1 refer to?

#### Question CH1-Q4 Answer:

**Answer:**

### Question 5.

What are the values for y1, y2, and y3 in the Air series?

#### Question CH1-Q5 Answer:

## Chapter 2:

Time Series Data (Page 43) #3

### Question 3.

Shipments of Household Appliance: The file ApplianceShipments.xls contains the series of quarterly shipments (in millions of USD) of U.S. household appliances between 1985-1989.

a)  Create a well-formatted time plot of the data.

b)  Which of the four components (level, trend, seasonality, noise) seem to be present in this series?


#### Question CH2-Q3 Answer:

```{r appliance_shipments}
library(readxl)
library(zoo)
library(tidyverse)
ApplianceShipments <- read_excel("ApplianceShipments.xlsx")

# Convert Quarter character to date
ApplianceShipments$Quarter <-
  as.Date(
    as.yearqtr(
      ApplianceShipments$Quarter,
      format = "Q%q-%Y"
      ),
    # "frac=1" sets date to last day of quarter
    # frac = 1 
    )


# Create Time Series Object
MyTS <- ts(ApplianceShipments$Shipments, 
           start = c(1985, 1), 
           frequency = 4)


# Plot the Time Series
autoplot(MyTS) +
  labs(title = "Appliance Shipments Over Time",
       x = "Quarter",
       y = "Shipments") +
  theme_minimal()

```


**Answer:** Looking at the chart above that we can see traces of all four components present in the series.  Some of the components are stronger than others, I would order them in terms of seasonality, trend as close contenders for strongest, followed by trend and then noise.


## Chapter 3:

Performance Evaluation (Pages 67-68) #2 and 3

### Question 2.

Forecasting Shampoo Sales: The file ShampooSales.xls contains data on the monthly sales of a certain shampoo over a three-year period.
If the goal is forecasting sales in future months, which of the following steps should be taken?
(choose one or more below).

-   [ ] Partition the data into training and validation periods.
-   [ ] Examine time plots of the series and of model forecasts only for the training period.
-   [ ] Look at MAPE and RMSE values for the training period.
-   [ ] Look at MAPE and RMSE values for the validation period.
-   [ ] Compute na誰ve forecasts. Page 1 of 2


#### Question CH3-Q2 Answer:

```{r shampoo}
library(fpp2) # Plot and Forecast Data
set.seed(506)

ShampooSales <- read_excel("ShampooSales.xlsx")

ShampooSales$Month <- as.Date(ShampooSales$Month)


# Create Time Series Object
MyTS <- ts(ShampooSales$Shampoo_sales, 
           start = c(1995, 1), 
           frequency = 12)

# MyTS

train <- window(MyTS, 
                start = c(1995, 1), 
                end = c(1996, 12))
# train
validation <- window(MyTS, 
                     start = c(1997, 1))
# validation


# Plot the Training and Validation Set
autoplot(train) +
  labs(title = "DGF Sales Volume Over Time",
       x = "Time",
       y = "Sales volume") +
  theme_minimal() +
  autolayer(validation, color = "blue")


# naive model -
# This takes the very last value of the training set.
n_model <- naive(train, h = 12, level = 95)


# Plot the Training Model with the Naive Model.
autoplot(train) +
  labs(title = "DGF Sales Volume Over Time",
       x = "Time",
       y = "Sales volume") +
  theme_minimal() +
  autolayer(n_model, color = "#006d2c", series = "Naive") +
  autolayer(validation, color = "blue", series = "Actual")


##################
# Model: seasonal naive -
# This takes a seasonal naive value.
sn_model <- snaive(train, h = 12)

autoplot(train) +
  labs(title = "DGF Sales Volume Over Time",
       x = "Time",
       y = "Sales volume") +
  theme_minimal() +
  autolayer(sn_model, color = "#006d2c", series = "Seasonal Naive") +
  autolayer(validation, color = "blue", series = "Actual")


##################
# Model season & trend
st_model <- tslm(train ~ trend + season)

summary(st_model)

st_forecast <- forecast(st_model, h = 12)

autoplot(train) +
  labs(title = "DGF Sales Volume Over Time",
       x = "Time",
       y = "Sales volume") +
  theme_minimal() +
  autolayer(st_forecast, color = "#006d2c", series = "season trend") +
  autolayer(validation, color = "blue", series = "Actual")


###############################
# Measure the errors

accuracy(n_model)
accuracy(sn_model)
accuracy(st_forecast)


n_model$fitted

```


```{r}
h=12

# Create Time Series Object
MyTS <- ts(ShampooSales$Shampoo_sales, 
           start = c(1995, 1), 
           frequency = 12)

# Split Data
train <- window(MyTS, 
                start = c(1995, 1), 
                end = c(1996, 12))

# Train Models
mean_fit <- meanf(train,h=h)
naive_fit <- naive(train,h=h,level = 95)
drift_fit <- rwf(train,h=h,drift=TRUE) # Drift method
snaive_fit <- snaive(train,h=h) # Seasonal Na誰ve 
st_model <- tslm(train ~ trend + season)
st_fit <- forecast(st_model,h=h)
exp_model <- tslm(train ~ trend + season, lambda = 0)
exp_fit <- forecast(exp_model,h=h)
spline_model <- tslm(train ~ trend + I(trend^2) + I(trend^3) + season)
spine_fit <- forecast(spline_model,h=h)

# Plot Results
autoplot(window(MyTS, start=1995)) +
  autolayer(mean_fit, series="Mean", PI=FALSE) +
  autolayer(drift_fit, series="Drift Method", PI=FALSE) +
  autolayer(snaive_fit, series="Seasonal na誰ve", PI=FALSE) +
  autolayer(naive_fit, series="Na誰ve", PI=FALSE) +
  autolayer(st_fit, series="Seasonal Trend", PI=FALSE) +
  autolayer(exp_fit, series="Exponential", PI=FALSE) +
  autolayer(spine_fit, series="Spline", PI=FALSE) +
  xlab("Year") + 
  ylab("Megalitres") +
  ggtitle("Forecasts for quarterly beer production") +
  theme_minimal() +
  guides(colour=guide_legend(title="Forecast"))
```




```{r}
window_df <- window(MyTS, start=1997)
accuracy(mean_fit, window_df)
accuracy(naive_fit, window_df)
accuracy(drift_fit, window_df)
accuracy(snaive_fit, window_df)
accuracy(st_fit, window_df)
accuracy(exp_fit, window_df)
accuracy(spine_fit, window_df)

```


```{r}
e <- tsCV(train, rwf, drift=TRUE, h=1)
sqrt(mean(e^2, na.rm=TRUE))
sqrt(mean(residuals(rwf(train, drift=TRUE))^2, na.rm=TRUE))
```


### Question 3.

Performance on Training and Validation Data: Two different models were fit to the same time series.
The first 100 time periods were used for the training period and the last 12 periods were treated as a validation period.
Assume that both models make sense practically and fit the data reasonably well.
Below are the RMSE values for each of the models:

| Model   | Training Period | Validation Period |
|:--------|:---------------:|:-----------------:|
| Model A |       543       |        690        |
| Model B |       669       |        675        |

a)  Which model appears more useful for retrospectively describing the different components of this time series?
    Why?

b)  Which model appears to be more useful for forecasting purposes?
    Why?
    
    
#### Question CH3-Q3 Answer:

**Answer:**
